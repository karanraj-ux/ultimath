<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEE War Room v5.0</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Roboto+Mono:wght@500&display=swap" rel="stylesheet">
    
    <style>
        /* ========================================= */
        /* VISUAL THEME (CYBERPUNK BLACK)           */
        /* ========================================= */
        :root { 
            --bg: #000000; 
            --card: #111111; 
            --text: #ffffff; 
            --accent: #00f3ff;   /* Neon Blue */
            --danger: #ff3b30;   /* Neon Red */
            --warn: #ffd700;     /* Gold */
            --success: #00ff9d;  /* Neon Green */
        }

        body { 
            font-family: 'Roboto Mono', monospace; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding: 20px; 
            padding-bottom: 150px; /* Space for scrolling */
        }

        h1 { 
            font-family: 'Rajdhani', sans-serif; 
            text-transform: uppercase; 
            letter-spacing: 3px; 
            color: var(--accent); 
            margin-bottom: 20px; 
            text-align: center;
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
        }

        h2 {
            color: var(--text);
            font-family: 'Rajdhani', sans-serif;
            font-size: 20px;
            margin-top: 0;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
        }
        
        /* CARD CONTAINER STYLE */
        .card { 
            background: var(--card); 
            padding: 25px; 
            border: 1px solid #333; 
            border-radius: 16px; 
            margin-bottom: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        /* INPUT FIELDS */
        label {
            display: block;
            font-size: 11px;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input, textarea, select { 
            width: 100%; 
            padding: 15px; 
            background: #000; 
            border: 1px solid #444; 
            color: #fff; 
            margin-bottom: 15px; 
            border-radius: 6px; 
            font-family: 'Roboto Mono', monospace; 
            font-size: 14px;
            box-sizing: border-box; 
        }
        
        input:focus, textarea:focus, select:focus { 
            border-color: var(--accent); 
            outline: none; 
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.1);
        }
        
        /* BUTTONS */
        .btn { 
            width: 100%; 
            padding: 18px; 
            background: var(--accent); 
            color: black; 
            font-weight: 800; 
            border: none; 
            border-radius: 8px; 
            margin-top: 15px; 
            font-family: 'Rajdhani', sans-serif; 
            font-size: 20px; 
            text-transform: uppercase; 
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:active { transform: scale(0.98); opacity: 0.9; }
        
        .btn-red { background: var(--danger); color: white; }
        .btn-green { background: var(--success); color: black; }
        .btn-warn { background: var(--warn); color: black; }
        .btn-dark { background: #333; color: white; border: 1px solid #555; }

        /* SCOREBOARD GRID */
        .score-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 15px; 
            margin-top: 20px; 
        }
        
        .score-box { 
            background: #1a1a1a; 
            padding: 20px; 
            text-align: center; 
            border-radius: 12px; 
            border-top: 4px solid #444; 
        }
        
        .score-val { font-size: 32px; font-weight: bold; color: white; }
        .score-label { font-size: 12px; color: #888; letter-spacing: 2px; margin-top: 5px; }
        
        /* MISTAKE TAGS */
        .tag-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px; }
        .tag-btn { 
            background: #222; border: 1px solid #444; color: #aaa; 
            padding: 15px; border-radius: 8px; text-align: center; 
            font-size: 12px; cursor: pointer;
        }
        .tag-btn:hover { border-color: white; color: white; }
        
        /* AI TEXT OUTPUT BOX */
        .ai-box { 
            border: 1px dashed var(--accent); 
            background: rgba(0, 243, 255, 0.05); 
            padding: 25px; 
            margin-top: 25px; 
            border-radius: 12px;
            white-space: pre-wrap; 
            color: #ddd; 
            font-size: 15px; 
            line-height: 1.8; 
            display: none; 
        }
        
        .blink { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        strong { color: var(--accent); }
    </style>
</head>
<body>

    <div class="container">
        <h1>JEE WAR ROOM <span style="font-size:12px; color:#666; display:block; margin-top:5px;">STUDENT DNA EDITION (v5.0)</span></h1>

        <div class="card">
            <h2 style="color:var(--warn)">0. Student DNA (Profile)</h2>
            <p style="font-size:13px; color:#aaa; margin-bottom:20px;">
                Tell the AI who you are. It will remember this forever and customize your strategy.
            </p>
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div>
                    <label>STUDENT STATUS</label>
                    <select id="studentStatus">
                        <option value="Dropper">Dropper (Target 2025)</option>
                        <option value="Class 12">Class 12 (Board + JEE)</option>
                        <option value="Class 11">Class 11 (Beginner)</option>
                    </select>
                </div>
                <div>
                    <label>ACADEMIC HISTORY</label>
                    <select id="academicHistory">
                        <option value="Average (70-85%)">Average (70-85%)</option>
                        <option value="Topper (90%+)">Topper (90%+)</option>
                        <option value="Struggler (<60%)">Struggler (Below 60%)</option>
                    </select>
                </div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div>
                    <label style="color:var(--accent)">WAKE UP TIME</label>
                    <input type="time" id="wakeTime">
                </div>
                <div>
                    <label style="color:var(--accent)">SLEEP TIME</label>
                    <input type="time" id="sleepTime">
                </div>
            </div>

            <label>SYLLABUS COVERAGE (Be Honest)</label>
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                <input type="range" id="syllabusRange" min="0" max="100" value="0" oninput="document.getElementById('syll-val').textContent = this.value + '%'">
                <span id="syll-val" style="font-size:20px; font-weight:bold; color:var(--success); width:60px;">0%</span>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div>
                    <label style="color:var(--success)">STRONG SUBJECT</label>
                    <select id="strongSub">
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Maths">Maths</option>
                    </select>
                </div>
                <div>
                    <label style="color:var(--danger)">WEAK SUBJECT</label>
                    <select id="weakSub">
                        <option value="Maths">Maths</option>
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                    </select>
                </div>
            </div>
            
            <label style="color:var(--success)">CHAPTERS COMPLETED (What you know)</label>
            <textarea id="completedChapters" placeholder="e.g. Kinematics, Electrostatics, Solutions..." style="height:60px;"></textarea>

            <label style="color:var(--danger)">KILLER CHAPTERS (What you hate)</label>
            <textarea id="weakChapters" placeholder="e.g. Rotational Motion, Ionic Equilibrium..." style="height:60px; border-color:var(--danger);"></textarea>
            
            <button class="btn btn-dark" onclick="warRoom.saveProfile()">üíæ SAVE DNA PROFILE</button>
        </div>


        <div class="card">
            <h2>1. Test Data</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:10px;">
                <div>
                    <label>PHYSICS</label>
                    <input type="number" id="p" placeholder="0">
                </div>
                <div>
                    <label>CHEMISTRY</label>
                    <input type="number" id="c" placeholder="0">
                </div>
                <div>
                    <label>MATHS</label>
                    <input type="number" id="m" placeholder="0">
                </div>
                <div>
                    <label style="color:var(--danger)">NEGATIVE</label>
                    <input type="number" id="neg" placeholder="-0" style="border-color:var(--danger); color:var(--danger)">
                </div>
            </div>
            <button class="btn" onclick="warRoom.calculateScore()">üíÄ ANALYZE PERFORMANCE</button>
        </div>


        <div id="results-section" class="card" style="display:none;">
            <h2>2. The Autopsy</h2>
            
            <div class="score-grid">
                <div class="score-box" style="border-color:var(--accent)">
                    <div class="score-val" id="s-phy">0</div>
                    <div class="score-label">PHYSICS</div>
                </div>
                <div class="score-box" style="border-color:var(--warn)">
                    <div class="score-val" id="s-chem">0</div>
                    <div class="score-label">CHEMISTRY</div>
                </div>
                <div class="score-box" style="border-color:var(--danger)">
                    <div class="score-val" id="s-math">0</div>
                    <div class="score-label">MATHS</div>
                </div>
            </div>
            
            <div class="tag-grid" style="margin-top:30px;">
                <button class="tag-btn" onclick="warRoom.addMistake('silly')">
                    SILLY ERROR<br>
                    <span id="c-silly" style="font-size:18px; color:var(--danger); font-weight:bold;">0</span>
                </button>
                <button class="tag-btn" onclick="warRoom.addMistake('concept')">
                    CONCEPT GAP<br>
                    <span id="c-concept" style="font-size:18px; color:var(--warn); font-weight:bold;">0</span>
                </button>
                <button class="tag-btn" onclick="warRoom.addMistake('time')">
                    TIME ISSUE<br>
                    <span id="c-time" style="font-size:18px; color:var(--accent); font-weight:bold;">0</span>
                </button>
            </div>

            <div style="height:300px; margin-top:30px;">
                <canvas id="radarChart"></canvas>
            </div>

            <button class="btn btn-red" onclick="warRoom.generateWarPlan()">‚ö° GENERATE BIO-STRATEGY</button>
            <div id="war-plan-result" class="ai-box" style="border-color:var(--danger);"></div>
        </div>


        <div class="card" style="border-color: var(--warn);">
            <h2 style="color:var(--warn)">3. Shortcut Hunter</h2>
            <p style="font-size:12px; color:#888;">
                Upload a screenshot of a "Hard" question. 
                AI will ignore the textbook method and find a "Jugaad" (Trick).
            </p>
            
            <input type="file" id="doubtImg" accept="image/*" style="margin-top:15px;">
            
            <button class="btn btn-warn" onclick="warRoom.huntShortcut()">üïµÔ∏è FIND SHORTCUT</button>
            
            <div id="shortcut-result" class="ai-box" style="border-color:var(--warn);"></div>
        </div>

    </div>

<script>
/* ================================================================
   CLASS: AI ENGINE
   Handles all communication with Gemini (Text & Vision)
   ================================================================
*/
class AiEngine {
    constructor() {
        // SECURITY: Split Key Logic to bypass bots
        const partA = "AIzaSy";
        const partB = "CMxc3KUDKp4ZtKBy91vqB6IfPG_48064c"; 
        this.apiKey = partA + partB;
    }

    // --- METHOD 1: TEXT GENERATION (War Plan with Bio-Data) ---
    async getWarPlan(stats, mistakes, profile) {
        const prompt = `
        I am a JEE aspirant. I just analyzed a mock test.

        USER BIO-DNA:
        - Status: ${profile.status}
        - Academic Level: ${profile.history}
        - Syllabus Completed: ${profile.syllabus}%
        - Wake Up: ${profile.wake} | Sleep: ${profile.sleep}
        - Strong Subject: ${profile.strong}
        - Weak Subject: ${profile.weak}
        - Chapters I Know: ${profile.completed}
        - Chapters I Hate: ${profile.hated}

        TEST PERFORMANCE:
        - Physics: ${stats.p}, Chemistry: ${stats.c}, Maths: ${stats.m}.
        - Total: ${stats.total}/300. 
        - Negative Marks: ${stats.neg}.
        - Mistake Types: Silly (${mistakes.silly}), Concept (${mistakes.concept}), Time (${mistakes.time}).

        TASK: Act like a top-tier JEE Mentor.
        1. REALITY CHECK: Roast my score based on my student status (e.g. if Dropper, be harsher).
        2. BIO-SCHEDULE: Create a 4-hour recovery plan for TODAY.
           - Schedule the WEAK SUBJECT (${profile.weak}) during my high-energy time (Morning/After Wake).
           - Schedule the STRONG SUBJECT (${profile.strong}) during low-energy time (Evening).
           - Do NOT tell me to study chapters I already know. Focus on the hated ones if they caused marks loss.
        3. FIX: Give me one specific technique to fix my most common mistake type (${mistakes.silly > mistakes.concept ? "Silly Errors" : "Concept Gaps"}).
        
        Format with Markdown.
        `;
        return await this.callGemini(prompt);
    }

    // --- METHOD 2: VISION GENERATION (Shortcut Hunter) ---
    async getShortcut(base64Image) {
        const prompt = `
        Look at this JEE Question.
        Do NOT give me the long standard solution.
        
        Find a SHORTCUT or TRICK to solve it in 30 seconds.
        Consider:
        - Dimensional Analysis
        - Value Substitution (put x=0, theta=90)
        - Option Elimination
        - Graphing method
        
        If no shortcut exists, say "No shortcut found."
        Keep the answer extremely short.
        `;
        return await this.callGeminiVision(prompt, base64Image);
    }

    // --- INTERNAL API CALLS ---
    async callGemini(text) {
        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${this.apiKey}`;
            const res = await fetch(url, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
            });
            const data = await responseHandler(res);
            return data;
        } catch(e) { return "AI Error: " + e.message; }
    }

    async callGeminiVision(text, base64) {
        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${this.apiKey}`;
            const res = await fetch(url, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    contents: [{ parts: [ { text: text }, { inline_data: { mime_type: "image/jpeg", data: base64 } } ] }]
                })
            });
            const data = await responseHandler(res);
            return data;
        } catch(e) { return "AI Error: " + e.message; }
    }
}

async function responseHandler(res) {
    const data = await res.json();
    if(data.error) throw new Error(data.error.message);
    return data.candidates[0].content.parts[0].text;
}

/* ================================================================
   CLASS: WAR ROOM CONTROLLER
   Handles Logic, LocalStorage, and UI
   ================================================================
*/
class WarRoom {
    constructor() {
        this.ai = new AiEngine();
        this.stats = { p:0, c:0, m:0, total:0, neg:0 };
        this.mistakes = { silly: 0, concept: 0, time: 0 };
        this.chart = null;
        
        // Default Profile
        this.profile = { 
            status: "Dropper", history: "Average", wake: "07:00", sleep: "23:00", 
            syllabus: "0", strong: "Physics", weak: "Maths", completed: "", hated: "" 
        };
        
        this.loadProfile();
        
        // Init PDF Library
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }

    // --- PROFILE MEMORY ---
    saveProfile() {
        this.profile = {
            status: document.getElementById('studentStatus').value,
            history: document.getElementById('academicHistory').value,
            wake: document.getElementById('wakeTime').value,
            sleep: document.getElementById('sleepTime').value,
            syllabus: document.getElementById('syllabusRange').value,
            strong: document.getElementById('strongSub').value,
            weak: document.getElementById('weakSub').value,
            completed: document.getElementById('completedChapters').value,
            hated: document.getElementById('weakChapters').value
        };
        localStorage.setItem('jee_dna_v5', JSON.stringify(this.profile));
        alert("Student DNA Saved! AI will now customize your plan.");
    }

    loadProfile() {
        const saved = localStorage.getItem('jee_dna_v5');
        if(saved) {
            this.profile = JSON.parse(saved);
            document.getElementById('studentStatus').value = this.profile.status;
            document.getElementById('academicHistory').value = this.profile.history;
            document.getElementById('wakeTime').value = this.profile.wake;
            document.getElementById('sleepTime').value = this.profile.sleep;
            document.getElementById('syllabusRange').value = this.profile.syllabus;
            document.getElementById('syll-val').textContent = this.profile.syllabus + "%";
            document.getElementById('strongSub').value = this.profile.strong;
            document.getElementById('weakSub').value = this.profile.weak;
            document.getElementById('completedChapters').value = this.profile.completed;
            document.getElementById('weakChapters').value = this.profile.hated;
        }
    }

    // --- SCORE CALCULATOR ---
    calculateScore() {
        this.stats.p = Number(document.getElementById('p').value) || 0;
        this.stats.c = Number(document.getElementById('c').value) || 0;
        this.stats.m = Number(document.getElementById('m').value) || 0;
        this.stats.neg = Number(document.getElementById('neg').value) || 0;
        this.stats.total = this.stats.p + this.stats.c + this.stats.m - Math.abs(this.stats.neg);

        document.getElementById('s-phy').textContent = this.stats.p;
        document.getElementById('s-chem').textContent = this.stats.c;
        document.getElementById('s-math').textContent = this.stats.m;
        document.getElementById('s-total').textContent = this.stats.total + "/300";
        document.getElementById('s-neg').textContent = this.stats.neg;
        
        document.getElementById('results-section').style.display = 'block';
        document.getElementById('results-section').scrollIntoView({behavior:'smooth'});
        
        this.renderChart();
    }

    // --- MISTAKE TAGGER ---
    addMistake(type) {
        this.mistakes[type]++;
        document.getElementById(`c-${type}`).textContent = this.mistakes[type];
        this.renderChart();
    }

    // --- RADAR CHART ---
    renderChart() {
        const ctx = document.getElementById('radarChart').getContext('2d');
        if(this.chart) this.chart.destroy();

        this.chart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['Physics', 'Chemistry', 'Maths', 'Accuracy', 'Speed', 'Concept'],
                datasets: [{
                    label: 'Current Performance',
                    data: [
                        this.stats.p, 
                        this.stats.c, 
                        this.stats.m, 
                        100 - (this.mistakes.silly * 5), 
                        100 - (this.mistakes.time * 5), 
                        100 - (this.mistakes.concept * 5)
                    ],
                    backgroundColor: 'rgba(0, 243, 255, 0.2)',
                    borderColor: '#00f3ff',
                    borderWidth: 2,
                    pointBackgroundColor: '#fff'
                }]
            },
            options: {
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100,
                        grid: { color: '#333' },
                        pointLabels: { color: '#fff', font: { size: 11 } },
                        ticks: { display: false }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    // --- GENERATE AI PLAN ---
    async generateWarPlan() {
        const box = document.getElementById('war-plan-result');
        box.style.display = 'block';
        box.innerHTML = "<span class='blink'>Analyzing Student DNA...</span>";

        const plan = await this.ai.getWarPlan(this.stats, this.mistakes, this.profile);
        box.innerHTML = this.formatText(plan);
    }

    // --- SHORTCUT HUNTER ---
    async huntShortcut() {
        const file = document.getElementById('doubtImg').files[0];
        if(!file) return alert("Upload an image first!");
        
        const box = document.getElementById('shortcut-result');
        box.style.display = 'block';
        box.textContent = "Scanning Image...";

        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = async () => {
            const base64 = reader.result.split(',')[1];
            const response = await this.ai.getShortcut(base64);
            box.innerHTML = this.formatText(response);
        };
    }

    formatText(text) {
        return text
            .replace(/\*\*(.*?)\*\*/g, '<strong style="color:#00f3ff">$1</strong>')
            .replace(/\n/g, '<br>');
    }
}

window.warRoom = new WarRoom();
</script>
</body>
    </html>
