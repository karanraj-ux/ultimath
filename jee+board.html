<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAR ROOM: JEE + BOARD IMPROVEMENT</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505; --card: #111; --border: #222; 
            --jee: #00f3ff; --board: #fbbf24; --danger: #ff3b30; --success: #00ff9d;
            --text: #eee; --dim: #666;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'JetBrains Mono', monospace; background: var(--bg); color: var(--text); margin: 0; padding: 15px; padding-bottom: 80px; }

        /* HEADER */
        .header { text-align: center; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        h1 { font-family: 'Rajdhani'; margin: 0; color: var(--board); letter-spacing: 2px; font-size: 28px; }
        .sub-tag { font-size: 10px; color: var(--dim); letter-spacing: 1px; text-transform: uppercase; }

        /* TABS */
        .tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .tab-btn {
            background: var(--card); border: 1px solid var(--border); color: var(--dim); 
            padding: 10px 15px; border-radius: 6px; flex: 1; min-width: 90px; 
            text-align: center; font-size: 12px; font-weight: bold; cursor: pointer;
            transition: 0.2s;
        }
        .tab-btn.active { border-color: var(--board); color: var(--board); background: rgba(251, 191, 36, 0.1); }

        /* SECTIONS */
        .view-section { display: none; animation: fade 0.3s; }
        .view-section.active { display: block; }
        @keyframes fade { from { opacity:0; transform:translateY(5px); } to { opacity:1; transform:translateY(0); } }

        /* CARDS */
        .card { background: var(--card); padding: 15px; border-radius: 10px; border: 1px solid var(--border); margin-bottom: 15px; }
        .card-h { font-size: 11px; color: var(--dim); letter-spacing: 1px; margin-bottom: 10px; display: block; font-weight: bold; }
        
        /* INPUTS */
        .sub-row { display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-bottom: 8px; align-items: center; }
        .sub-label { font-size: 13px; color: #ccc; }
        input, select { 
            width: 100%; background: #000; border: 1px solid #333; color: white; 
            padding: 10px; border-radius: 5px; font-family: inherit; outline: none; text-align: center;
        }
        input:focus { border-color: var(--board); }

        /* ACTION BUTTON */
        .btn-main {
            width: 100%; background: var(--board); color: black; font-weight: 800; border: none;
            padding: 14px; border-radius: 6px; cursor: pointer; font-family: 'Rajdhani'; font-size: 18px;
            margin-top: 10px;
        }
        .btn-jee { background: var(--jee); }

        /* CALCULATOR RESULT */
        .result-box { 
            margin-top: 15px; padding: 15px; background: rgba(251, 191, 36, 0.05); 
            border: 1px dashed var(--board); border-radius: 8px; text-align: center; display: none; 
        }
        .gap-val { font-size: 32px; font-weight: 800; color: var(--danger); font-family: 'Rajdhani'; }
        .safe-val { color: var(--success); }

        /* SYLLABUS */
        .ch-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px; border-bottom: 1px solid #222; 
        }
        .ch-name { font-size: 13px; font-weight: bold; }
        .ch-fire { color: var(--danger); font-size: 12px; margin-left: 5px; }
        .tags { display: flex; gap: 8px; }
        .tag { 
            font-size: 9px; padding: 4px 8px; border-radius: 4px; cursor: pointer; 
            border: 1px solid #333; color: #666; font-weight: bold;
        }
        .tag.done-jee { background: rgba(0, 243, 255, 0.15); border-color: var(--jee); color: var(--jee); }
        .tag.done-board { background: rgba(251, 191, 36, 0.15); border-color: var(--board); color: var(--board); }

        /* SCHEDULE */
        .mode-switch { display: flex; background: #000; border-radius: 8px; padding: 4px; border: 1px solid #333; margin-bottom: 15px; }
        .mode-opt { flex: 1; text-align: center; padding: 8px; font-size: 12px; border-radius: 5px; cursor: pointer; color: #666; }
        .mode-opt.active { background: #222; color: white; font-weight: bold; }
        .mode-opt.jee-active { background: rgba(0, 243, 255, 0.1); color: var(--jee); border: 1px solid var(--jee); }
        .mode-opt.board-active { background: rgba(251, 191, 36, 0.1); color: var(--board); border: 1px solid var(--board); }

        .timeline-item { 
            border-left: 2px solid #333; padding: 0 0 20px 20px; margin-left: 10px; position: relative; 
        }
        .timeline-item::before {
            content: ''; position: absolute; left: -6px; top: 0; width: 10px; height: 10px;
            border-radius: 50%; background: #333;
        }
        .timeline-item.jee-slot { border-color: rgba(0, 243, 255, 0.3); }
        .timeline-item.jee-slot::before { background: var(--jee); box-shadow: 0 0 8px var(--jee); }
        .timeline-item.board-slot { border-color: rgba(251, 191, 36, 0.3); }
        .timeline-item.board-slot::before { background: var(--board); box-shadow: 0 0 8px var(--board); }
        
        .t-time { font-size: 11px; color: var(--dim); margin-bottom: 4px; }
        .t-task { font-size: 14px; font-weight: bold; color: #fff; }
        .t-desc { font-size: 11px; color: #888; margin-top: 2px; }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>IMPROVEMENT WAR ROOM</h1>
        <div class="sub-tag">TARGET: 75% BOARD + 95%ILE JEE</div>
    </div>

    <div class="tabs">
        <div class="tab-btn active" onclick="app.tab('calc')">ðŸ§® 75% CALC</div>
        <div class="tab-btn" onclick="app.tab('plan')">ðŸ“… ROUTINE</div>
        <div class="tab-btn" onclick="app.tab('track')">ðŸŽ¯ CHAPTERS</div>
    </div>

    <div id="view-calc" class="view-section active">
        <div class="card">
            <span class="card-h">CURRENT MARKS (OLD RESULT)</span>
            <div id="subject-inputs">
                </div>
            <div class="sub-row" style="margin-top:15px; border-top:1px solid #222; padding-top:10px;">
                <span class="sub-label" style="color:white;">TOTAL (500)</span>
                <span id="total-old" style="text-align:right; font-weight:bold; font-size:14px;">0</span>
            </div>
            <button class="btn-main" onclick="app.calculateGap()">ANALYZE GAP</button>

            <div id="gap-result" class="result-box">
                <div style="font-size:12px; color:#888; margin-bottom:5px;">MARKS NEEDED FOR 75%</div>
                <div id="gap-val-display" class="gap-val">0</div>
                <div id="strategy-text" style="font-size:12px; color:#aaa; margin-top:10px; line-height:1.4;"></div>
            </div>
        </div>
    </div>

    <div id="view-plan" class="view-section">
        <div class="card">
            <span class="card-h">CURRENT PRIORITY</span>
            <div class="mode-switch">
                <div class="mode-opt jee-active" id="btn-m-jee" onclick="app.setMode('jee')">JEE MAIN (Logic)</div>
                <div class="mode-opt" id="btn-m-board" onclick="app.setMode('board')">BOARD (Writing)</div>
            </div>
            <div class="sub-row">
                <span class="sub-label">WAKE UP TIME</span>
                <input type="time" id="wake-time" value="06:00" onchange="app.renderRoutine()">
            </div>
        </div>

        <div id="routine-list" style="margin-top:20px;"></div>
    </div>

    <div id="view-track" class="view-section">
        <div class="card">
            <span class="card-h">GOLDEN CHAPTERS (HIGH WEIGHTAGE IN BOTH)</span>
            <p style="font-size:11px; color:#666; margin-bottom:15px;">
                ðŸ”¥ = Must do for both. Easy to score in Improvement.
            </p>
            <div id="chapter-container"></div>
        </div>
    </div>

</div>

<script>
const DB = {
    load: () => JSON.parse(localStorage.getItem('imp_data_v1') || JSON.stringify(DEFAULT_DATA)),
    save: (d) => localStorage.setItem('imp_data_v1', JSON.stringify(d))
};

const DEFAULT_DATA = {
    subjects: [
        { name: "Physics", marks: 0 },
        { name: "Chemistry", marks: 0 },
        { name: "Maths", marks: 0 },
        { name: "English", marks: 0 },
        { name: "Optional", marks: 0 }
    ],
    mode: 'jee', // 'jee' or 'board'
    chapters: {
        "Modern Physics": { fire:true, jee:false, board:false },
        "Semiconductors": { fire:true, jee:false, board:false },
        "Current Elec": { fire:true, jee:false, board:false },
        "Ray Optics": { fire:true, jee:false, board:false },
        "Coordination Comp": { fire:true, jee:false, board:false },
        "Solutions": { fire:false, jee:false, board:false },
        "Electrochemistry": { fire:false, jee:false, board:false },
        "Vectors & 3D": { fire:true, jee:false, board:false },
        "Matrices/Det": { fire:true, jee:false, board:false }
    }
};

const app = {
    state: DB.load(),

    init: function() {
        this.renderCalcInputs();
        this.renderChapters();
        this.renderRoutine();
        this.updateModeUI();
    },

    tab: function(t) {
        document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
        document.getElementById('view-'+t).classList.add('active');
        document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active'));
        event.target.classList.add('active');
    },

    // --- MODULE 1: CALCULATOR ---
    renderCalcInputs: function() {
        const div = document.getElementById('subject-inputs');
        div.innerHTML = '';
        this.state.subjects.forEach((sub, i) => {
            div.innerHTML += `
                <div class="sub-row">
                    <span class="sub-label">${sub.name}</span>
                    <input type="number" value="${sub.marks > 0 ? sub.marks : ''}" 
                        placeholder="/100" oninput="app.updateMark(${i}, this.value)">
                </div>`;
        });
        this.calcTotal();
    },

    updateMark: function(idx, val) {
        this.state.subjects[idx].marks = parseInt(val) || 0;
        DB.save(this.state);
        this.calcTotal();
    },

    calcTotal: function() {
        const total = this.state.subjects.reduce((a,b) => a + b.marks, 0);
        document.getElementById('total-old').innerText = total;
    },

    calculateGap: function() {
        const total = this.state.subjects.reduce((a,b) => a + b.marks, 0);
        const target = 375; // 75% of 500
        const gap = target - total;
        const box = document.getElementById('gap-result');
        const val = document.getElementById('gap-val-display');
        const strat = document.getElementById('strategy-text');
        
        box.style.display = 'block';
        
        if (gap <= 0) {
            val.innerText = "SAFE âœ…";
            val.className = "gap-val safe-val";
            strat.innerText = "You are already eligible. Focus 100% on JEE Mains.";
        } else {
            val.innerText = `+${gap} MARKS`;
            val.className = "gap-val";
            // Intelligent Strategy
            let lowest = this.state.subjects.slice().sort((a,b) => a.marks - b.marks)[0];
            strat.innerHTML = `
                Strategy: You need <b>${gap}</b> more marks.<br>
                Target your weakest subject: <b>${lowest.name}</b> (Currently ${lowest.marks}).<br>
                If you improve ${lowest.name} to ${Math.min(lowest.marks + gap + 5, 95)}, you win.
            `;
        }
    },

    // --- MODULE 2: ROUTINE ---
    setMode: function(m) {
        this.state.mode = m;
        DB.save(this.state);
        this.updateModeUI();
        this.renderRoutine();
    },

    updateModeUI: function() {
        const m = this.state.mode;
        document.getElementById('btn-m-jee').className = `mode-opt ${m==='jee'?'jee-active':''}`;
        document.getElementById('btn-m-board').className = `mode-opt ${m==='board'?'board-active':''}`;
    },

    renderRoutine: function() {
        const wake = document.getElementById('wake-time').value; // "06:00"
        const [h, m] = wake.split(':').map(Number);
        const list = document.getElementById('routine-list');
        list.innerHTML = '';

        const isJee = this.state.mode === 'jee';
        
        // Dynamic Schedule Generator
        const tasks = [
            { min: 0, title: "WAKE UP + FORMULAS", type: "neutral", desc: "Review Short Notes immediately." },
            { min: 60, title: isJee ? "PHYSICS (Numericals)" : "PHYSICS (Derivations)", type: isJee ? "jee-slot" : "board-slot", desc: isJee ? "Solve 20 PYQs." : "Write 3 Long Derivations." },
            { min: 240, title: "BREAK / SCHOOL", type: "neutral", desc: "Rest or attend classes." },
            { min: 360, title: isJee ? "MATHS (Problem Solving)" : "MATHS (NCERT Examples)", type: isJee ? "jee-slot" : "board-slot", desc: isJee ? "Timed Practice." : "Step-by-step writing." },
            { min: 600, title: isJee ? "CHEMISTRY (NCERT Reading)" : "CHEMISTRY (Definitions)", type: isJee ? "jee-slot" : "board-slot", desc: "Inorganic/Organic." },
            { min: 840, title: "ENGLISH / OPTIONAL", type: "board-slot", desc: "30 mins reading (Easy marks for 75%)." }
        ];

        tasks.forEach(task => {
            // Simple time calc
            let timeH = h + Math.floor(task.min / 60);
            let timeM = m + (task.min % 60);
            if(timeM >= 60) { timeH++; timeM -= 60; }
            if(timeH >= 24) timeH -= 24;
            
            const timeStr = `${timeH.toString().padStart(2,'0')}:${timeM.toString().padStart(2,'0')}`;
            
            list.innerHTML += `
                <div class="timeline-item ${task.type}">
                    <div class="t-time">${timeStr}</div>
                    <div class="t-task">${task.title}</div>
                    <div class="t-desc">${task.desc}</div>
                </div>`;
        });
    },

    // --- MODULE 3: TRACKER ---
    renderChapters: function() {
        const div = document.getElementById('chapter-container');
        div.innerHTML = '';
        for (const [name, data] of Object.entries(this.state.chapters)) {
            div.innerHTML += `
                <div class="ch-item">
                    <div class="ch-name">${name} ${data.fire ? 'ðŸ”¥' : ''}</div>
                    <div class="tags">
                        <div class="tag ${data.jee ? 'done-jee' : ''}" 
                             onclick="app.toggleCh('${name}','jee')">PYQ</div>
                        <div class="tag ${data.board ? 'done-board' : ''}" 
                             onclick="app.toggleCh('${name}','board')">WRT</div>
                    </div>
                </div>`;
        }
    },

    toggleCh: function(name, type) {
        this.state.chapters[name][type] = !this.state.chapters[name][type];
        DB.save(this.state);
        this.renderChapters();
    }
};

app.init();
</script>
</body>
</html>